<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <title>Dashboard</title>
</head>
<body onload="grafico()">
    <canvas id="pontuacaoChart" style="width: 20%;"></canvas>
    <canvas id="pontuacaoChart1" style="width: 20%;"></canvas>
    <p id="resultado"></p>
        <button onclick="executar()">Ativar SQL</button>
    
</body>
<!-- <body>
    <h1>Dashboard</h1>
        
</body> -->
</html>
    <script>

      let ListaUsuarios = [];
      let ListaPontuacao = [];

      function grafico(){

        fetch('/pontuacao/listar', { method: 'POST' })
        .then(response => response.json())
        .then(pontuacoes => {
            // ... (código do gráfico como mostrado acima) 
        })
        .catch(error => console.error('Erro ao buscar pontuações:', error));


        fetch('/pontuacao/listar', { method: 'POST' })
.then(response => response.json())
.then(pontuacoes => {
    // 1. Declarando as Arrays:
    const labels = []; // Array para armazenar os rótulos do eixo X (Usuários)
    const data = [];   // Array para armazenar os dados do eixo Y (Pontuações)
    const arrayDupla = [];

    // 2. Iterando sobre os Dados da API:
    pontuacoes.forEach(pontuacao => {
        // Para cada objeto 'pontuacao' recebido da API:
        
        // 3. Formatando e Adicionando Rótulos:
        labels.push(pontuacao.nome); 
        // - Crie uma string formatada com "Usuário" e o ID do usuário.
        // - Adicione essa string formatada ao array 'labels' usando 'push'.

        // 4. Adicionando Pontuações:
        data.push(pontuacao.pontuacao);
        // - Extraia a pontuação do objeto 'pontuacao'.
        // - Adicione a pontuação ao array 'data' usando 'push'.

        arrayDupla.push({
          NAME: pontuacao.nome, POINTS: pontuacao.pontuacao
        },);
    });
    // console.log(arrayDupla);
    // Limita os dados para os últimos 7 valores
    const ultimosLabels = labels.slice(-7); 
    const ultimosDados = data.slice(-7);

    // Obtendo o contexto do canvas
    const ctx = document.getElementById('pontuacaoChart').getContext('2d');

    // Criando o gráfico de barras (você pode escolher outro tipo)
    new Chart(ctx, {
        type: 'bar',
        data: {
            labels: ultimosLabels,
            datasets: [{
                label: 'Ultimas Pontuações',
                data: ultimosDados,
                backgroundColor: 'rgba(54, 162, 235, 0.2)',
                borderColor: 'rgba(54, 162, 235, 1)',
                borderWidth: 1
            }]
        },
        options: {
            // Opções de personalização do gráfico (título, eixos, etc.)
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });

    
    
    // Ordena a array em ordem decrescente
    arrayDupla.sort((a, b) => b.POINTS - a.POINTS);

    // Pega os primeiros 7 valores da array ordenada
    const top7 = arrayDupla.slice(0, 7);

    const top7Names = top7.map(item => item.NAME);
    const top7Points = top7.map(item => Number(item.POINTS));

    const topNome = []
    const topValor = []

    for(let i = 0; i < top7Names.length; i++ ){
      topNome.push(top7Names[i]);
      topValor.push(top7Points[i]);
    }

    console.log(topNome);

    console.log(topValor);
    

    const ctx1 = document.getElementById('pontuacaoChart1').getContext('2d');
    
    new Chart(ctx1, {
        type: 'bar',
        data: {
            labels: topNome,
            datasets: [{
                label: 'Melhores Pontuações',
                data: topValor,
                backgroundColor: 'rgba(54, 162, 235, 0.2)',
                borderColor: 'rgba(54, 162, 235, 1)',
                borderWidth: 1
            }]
        },
        options: {
            // Opções de personalização do gráfico (título, eixos, etc.)
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });
})
.catch(error => console.error('Erro ao buscar pontuações:', error));
}



// const labels = []; 
// const data = [];

function executar(){

  // Faz a requisição para a rota /listar
  fetch('/pontuacao/listar', { method: 'POST' }) 
    .then(response => response.json())
    .then(pontuacoes => {
  // Manipula o JSON com as pontuações
  const pontuacoesList = document.getElementById('pontuacoes-list');
  pontuacoes.forEach(pontuacao => {

    // labels.push(`Usuário ${pontuacao.fkUsuario}`); 
   
    // data.push(pontuacao.pontuacao);

    const listItem = document.createElement('li');
    // console.log(data , labels)
    console.log(pontuacao.pontuacao)
    resultado.innerHTML += `Media de pontos ${2*(pontuacao.pontuacao)} pontos <br>`;
    
  });
})
.catch(error => console.error('Erro ao buscar pontuações:', error));

}

      /*
      let lista = []
function executar(){

  // Faz a requisição para a rota /listar
  fetch('/pontuacao/listar', { method: 'POST' }) 
  .then(response => response.json())
  .then(pontuacoes => {
  // Manipula o JSON com as pontuações
  const pontuacoesList = document.getElementById('pontuacoes-list');
  pontuacoes.forEach(pontuacao => {
    const listItem = document.createElement('li');
    console.log(pontuacao)
    resultado.innerHTML += `Usuário ${pontuacao.fkUsuario}: ${pontuacao.pontuacao} pontos <br>`;
    
  });
})
.catch(error => console.error('Erro ao buscar pontuações:', error));

}

ESSE FUNCIONAAAA
*/


    </script>
