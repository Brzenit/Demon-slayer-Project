<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Demon Slayer | Quiz</title>
    <link rel="stylesheet" href="./css/quiz.css">
    <link rel="shortcut icon" href="./img/Icons/Demon-Slayer-Logo (1).ico">
</head>

<body>
    <div>
        <button id="back_btn" class="button back">
            <a href="./index.html">
                Voltar
            </a>
        </button>
    </div>
<!-- <img src="" alt="FELIZ"> -->
    <div class="container">

        <div id="box_div" class="question-container hide">
            <p id="questionAtual">01/10</p>
            <center class="question">Pegunta sobre Demon Slayer Aqui</center>
            <div id="respostas_div" class="answers-container">
                <button onclick="selecionarResposta()" class="answer button" disabled>Resposta 1</button>
                <button onclick="selecionarResposta()" class="answer button">Resposta 2</button>
                <button onclick="selecionarResposta()" class="answer button">Resposta 3</button>
                <button onclick="selecionarResposta()" class="answer button">Resposta 4</button>
            </div>
        </div>
        <div class="controls-container">
            <button id="start_btn" onclick="iniciarQuiz()" class="button">
                Come√ßar Quiz
            </button>
            <button id="next_btn"  class="next-question button hide">
                Proxima Pergunta
            </button>
        </div>
    </div>
<!-- <img src="" alt="BRAVO"> -->

</body>

</html>

<script>

    const perguntaText = document.querySelector(".question");
    let perguntaAtual = 0;
    let totalAcertos = 0;

    start_btn.addEventListener("click", iniciarQuiz);
    next_btn.addEventListener("click", nextQuestion);
    
    
    function iniciarQuiz() {
        shuffle(questions);
        shuffleQuestionsAndAnswers(questions);
        
        back_btn.classList.add("hide");
        start_btn.classList.add("hide");
        box_div.classList.remove("hide");
        nextQuestion();
    }
    
    QuestaoAtual = -1
    function nextQuestion() {
        QuestaoAtual++
        resetTudo();

        if (questions.length === perguntaAtual) {
            return finishGame();
        }

        questionAtual.innerHTML = `${QuestaoAtual}/12`

        perguntaText.textContent = questions[perguntaAtual].question
        questions[perguntaAtual].answers.forEach(answer => {
            const novaResposta = document.createElement("button")
            novaResposta.classList.add("answer", "button")
            novaResposta.textContent = answer.text
            if (answer.correct) {
                novaResposta.dataset.correct = answer.correct

            }
            respostas_div.appendChild(novaResposta)

            novaResposta.addEventListener("click", selecionarResposta)

        })
    }

    function resetTudo() {
        while (respostas_div.firstChild) {
            respostas_div.removeChild(respostas_div.firstChild);
        };
        document.body.classList.remove("correct", "incorrect");
        next_btn.classList.add("hide");
    }

    function selecionarResposta(event) {
        const respostaSelecionada = event.target;

        if (respostaSelecionada.dataset.correct) {
            document.body.classList.add("correct");
            totalAcertos++
        } else {
            document.body.classList.add("incorrect");
        }
        console.log(event.target);

        modificarCorBotao()

        next_btn.classList.remove("hide");
        perguntaAtual++

    }
    function modificarCorBotao() {
        document.querySelectorAll(".answer").forEach(button => {
            if (button.dataset.correct === "true") {
                button.classList.add("correct")
            } else {
                button.classList.add("incorrect")
            }
            button.disabled = true
        })
    }
    function finishGame() {
        const totalQuest√µes = questions.length
        const acertos = Math.floor(totalAcertos * 100 / totalQuest√µes)

        let mensagem = ""

        if (acertos >= 90) {
            mensagem = "Parab√©ns! voc√™ foi muito bem, conhece bastante coisa sobre Demon Slayer üòé"
        } else if (acertos >= 70) {
            mensagem = "Boa! voc√™ acertou mais que 60% do questionario, √© um Otaku M√©dio üëå"
        } else if (acertos > 50) {
            mensagem = "Poxa pode melhorar hein! mais j√° est√° acima de 50% dos acertos"
        } else {
            mensagem = "Ou voc√™ chegou aqui de paraquedas ou nem leu meu siteüò≠"
        }

        box_div.innerHTML = `
           <center>
            <p>voc√™ acertou ${totalAcertos} de 12 Quest√µes, Sua porcentagem de acerto foi de ${acertos}% !</p>
            <br>
            <p>Resultado ${mensagem}</p>
            <center>
            <br>
            <button class="button" onclick="pontuar()">Ver Ranking</button>
        `
    }

    function voltarParaDashboard() {
        setTimeout(function () {
            window.location = "./dashboard/cards.html";
        }, 1000);
    }

    function shuffle(questions) {
        // Percorre o array de tr√°s para frente
        for (let i = questions.length - 1; i > 0; i--) {
            // Gera um √≠ndice aleat√≥rio entre 0 e i
            const j = Math.floor(Math.random() * (i + 1));
            // Troca o elemento na posi√ß√£o i com o elemento na posi√ß√£o j
            [questions[i], questions[j]] = [questions[j], questions[i]];
        }
    }


    function shuffleQuestionsAndAnswers(questions) {
        
        questions.forEach(question => {
            shuffle(question.answers);
        });
    }

//func√ß√£o que calcula o tempo inicia em uma variavel global 


    function pontuar() {
        console.log("estou na func pontuar.")
        var idUsuario = sessionStorage.ID_USUARIO;
        console.log(idUsuario)
        // var pontuacao = totalAcertos.pontuacao;kk

        fetch(`/pontuacao/pontuar/`,{
            method: "POST",
            headers:{
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                idUsuarioServer: idUsuario,
                totalAcertosServer: totalAcertos
            })
            
        }).then(function(resposta) {
            
            console.log("resposta:", resposta);

            if(resposta.ok){
                console.log("pontua√ß√£o realizada com sucesso! pelo "+ idUsuario + " com total de: " + totalAcertos + " pontos!");
                window.location = "./dashboard/cards.html";
            } else if (resposta.status == 404) {
                window.alert("Deu 404!");
            } else {
                throw ("Houve um erro ao tentar cadastrar a pontua√ß√£o! C√≥digo da resposta: " + resposta.status);
            }
        })
            .catch(function (resposta) {
                console.log(`Erro: ${resposta}`);

            });

            return false;
    }


    const questions = [
        {
            question: "Qual √© a rela√ß√£o entre Nezuko e Tanjiro?",
            answers: [
                { text: "Eles s√£o primos", correct: false },
                { text: "Eles s√£o irm√£os", correct: true },
                { text: "Eles s√£o amigos de inf√¢ncia", correct: false },
                { text: "Eles s√£o mestre e aprendiz", correct: false }
            ]
        },
        {   
            question: "Qual √© a habilidade especial de Nezuko ap√≥s se transformar em dem√¥nio?",
            answers: [
                { text: "Sangue explosivo", correct: true },
                { text: "Manipular o tempo", correct: false },
                { text: "Invocar esp√≠ritos", correct: false },
                { text: "Controlar o fogo", correct: false }
            ]
        },
        {
            question: "Qual √© a respira√ß√£o utilizada por Tanjiro?",
            answers: [
                { text: "Respira√ß√£o do Fogo", correct: false },
                { text: "Respira√ß√£o do Trov√£o", correct: false },
                { text: "Respira√ß√£o da √Ågua", correct: true },
                { text: "Respira√ß√£o da Flor", correct: false }
            ]
        },
        {
            question: "Qual o principal objetivo de Tanjiro na s√©rie?",
            answers: [
                { text: "Se tornar o Hashira mais forte", correct: false },
                { text: "Derrotar todos os dem√¥nios", correct: false },
                { text: "Encontrar uma cura para Nezuko", correct: true },
                { text: "Vingar a morte de seus pais", correct: false }
            ]
        },
        {
            question: "Qual √© o maior medo de Zenitsu?",
            answers: [
                { text: "Altura", correct: false },
                { text: "√Ågua", correct: false },
                { text: "Mulheres", correct: false },
                { text: "Dem√¥nios", correct: true }
            ]
        },
        {
            question: "Qual √© a t√©cnica que Zenitsu usa para combater dem√¥nios?",
            answers: [
                { text: "Respira√ß√£o do Trov√£o", correct: true },
                { text: "Respira√ß√£o da Fera", correct: false },
                { text: "Respira√ß√£o da √Ågua", correct: false },
                { text: "Respira√ß√£o do Vento", correct: false }
            ]
        },
        {
            question: "Quem √© o Hashira do Som?",
            answers: [
                { text: "Giyu Tomioka", correct: false },
                { text: "Sanemi Shinazugawa", correct: false },
                { text: "Kyojuro Rengoku", correct: false },
                { text: "Tengen Uzui", correct: true }
            ]
        },
        {
            question: "Quantas esposas Tengen Uzui tem?",
            answers: [
                { text: "Uma", correct: false },
                { text: "Tr√™s", correct: true },
                { text: "Duas", correct: false },
                { text: "Quatro", correct: false }
            ]
        },
        {
            question: "Qual √© a t√©cnica especial de Kyojuro Rengoku?",
            answers: [
                { text: "Respira√ß√£o do Vento", correct: false },
                { text: "Respira√ß√£o da fogo", correct: false },
                { text: "Respira√ß√£o das Chamas", correct: true },
                { text: "Respira√ß√£o do Trov√£o", correct: false }
            ]
        },
        {
            question: "Qual √© o destino de Kyojuro Rengoku ap√≥s a luta contra Akaza?",
            answers: [
                { text: "Ele derrota Akaza", correct: false },
                { text: "Ele morre", correct: true },
                { text: "Ele se torna um dem√¥nio", correct: false },
                { text: "Ele se aposenta", correct: false }
            ]
        },
        {
            question: "Quem √© o l√≠der dos Hashiras?",
            answers: [
                { text: "Kagaya Ubuyashiki", correct: true },
                { text: "Tanjiro Kamado", correct: false },
                { text: "Kyojuro Rengoku", correct: false },
                { text: "Giyu Tomioka", correct: false }
            ]
        },
        {
            question: "Qual √© o nome do dem√¥nio principal que Tanjiro e seus amigos est√£o tentando derrotar?",
            answers: [
                { text: "Akaza", correct: false },
                { text: "Daki", correct: false },
                { text: "Gyutaro", correct: false },
                { text: "Muzan Kibutsuji", correct: true }
            ]
        },
    ];


</script>